const fs = require('fs');
const path = require('path');

const MANIFEST_PATH = './web/dev/scripts/entrypoints/manifest.json';
const OUTPUT_GO = './internal/resources/resources.go';

const manifest = JSON.parse(fs.readFileSync(MANIFEST_PATH, 'utf-8'));

const lines = [];
lines.push('// Code generated by generate-resources.js; DO NOT EDIT.');
lines.push('package resources');
lines.push('');

if (fs.existsSync(OUTPUT_GO)) {
	fs.unlinkSync(OUTPUT_GO);
}

for (const [outputPath, meta] of Object.entries(manifest)) {
	if (!meta.entryPoint) continue;

	const entryName = path.basename(
		meta.entryPoint,
		path.extname(meta.entryPoint)
	);
	const constName =
		entryName.charAt(0).toUpperCase() + entryName.slice(1) + 'ScriptJSPath';

	const publicPath = '/' + outputPath.replace(/^web\//, '');

	lines.push(`const ${constName} = "${publicPath}"`);
}

fs.writeFileSync(OUTPUT_GO, lines.join('\n') + '\n');

console.log('resources.go generated successfully');
